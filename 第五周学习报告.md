# 第五周学习报告

### 1..初识固件库

#### 1-汇编编写的启动文件

startup_stm32f10x_hd.s:设置堆栈指针、设置pc指针、初始化中断向量表、配置系统时钟、对用C库函数——main最终去到C的世界

#### 2-时钟配置文件

system_stm32f10x.c:把外部时钟HSE=8M，经过PLL倍额为72M.

#### 3-外设相关的

stm32f10x.h:实现了寄存器映射
xxx:GPIO、USRAT、I2C、SPI、FSMC
stm32f10x_xx.c:外设的驱动函数库文件
stm32f10x_xx.h:存放外设的初始化结构体，外设初始化结构体成员的参数列表，外设固件库函数的声明

#### 4-内核相关的

CMSIS - Cortex 微控制软件接口标准
core_cm3.h:实现内核里面外设的寄存器映射
core_cm3.c:内核外设的驱动固件库

NVIC(嵌套向量中断控制器）、SysTick(系统滴答定时器）
misc.h
misc.c

#### 5-头文件的配置文件

stm32f10x_conf.h:头文件的头文件
//stm32f10x_i2c.h
//stm32f10x_spi.h
//stm32f10x_adc.h
//stm32f10x_fsmc.h
......

#### 6-专门存放中断服务函数的c文件

stm32f10x_it.c
stm32f10x_it.h

中断服务函数可以放在随意位置，并不一定要放在stm32f10x_it.c 

#include “stm32f10x.h"  		//相当于51单片机中的 #include <reg52.h>
int main(void)
{
	//来到这里的时候，系统时钟已经配置成72M
}

### 2.配置固件库工程模板

固件库的工程模版比之前弄得更系统化，将不同文件划分到不同文件夹里，因为之前有过准备所以不算难（我才不不会是说我拖了一天才配好）

### 3.使用固件库点亮LED

不知道咋说，直接拿出跟着视频打的代码

##### bsp_led.c:

```
#include "stm32f10x.h"
#include "bsp_led.h"

void LED_GPIO_Config(void)
{
	GPIO_InitTypeDef  GPIO_InitStruct;
	
	RCC_APB2PeriphClockCmd(LED_G_GPIO_CLK, ENABLE);//选择时钟线初始化
	
	GPIO_InitStruct.GPIO_Pin = LED_G_GPIO_PIN;//选择IO口
	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_PP;//模式推挽输出
	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;//IO口驱动电路的响应频率
	
	GPIO_Init(LED_G_GPIO_PORT, &GPIO_InitStruct);	
}

```

###### bsp_led.h:

```
#ifndef __BSP_LED_H
#define __BSP_LED_H

#include "stm32f10x.h"

#define LED_G_GPIO_PIN              GPIO_Pin_0 
#define LED_G_GPIO_PORT             GPIOB
#define LED_G_GPIO_CLK              RCC_APB2Periph_GPIOB


#define    ON        1
#define    OFF       0

// \  C语言里面叫续行符，后面不能有任何的东西

#define   LED_G(a)   if(a) \
	                       GPIO_ResetBits(LED_G_GPIO_PORT, LED_G_GPIO_PIN); \
                     else  GPIO_SetBits(LED_G_GPIO_PORT, LED_G_GPIO_PIN);

void LED_GPIO_Config(void);

#endif /* __BSP_LED_H */


```

##### main.c:

```
#include "stm32f10x.h"   // 相当于51单片机中的  #include <reg51.h>
#include "bsp_led.h"

void Delay( uint32_t count )
{
	for(; count!=0; count--);
}

int main(void)
{
	// 来到这里的时候，系统的时钟已经被配置成72M。
	LED_GPIO_Config();//用来点亮LED
	
	while(1)
	{
		//GPIO_SetBits(LED_G_GPIO_PORT, LED_G_GPIO_PIN);
		LED_G(OFF);
		Delay(0xFFFFF);
		//GPIO_ResetBits(LED_G_GPIO_PORT, LED_G_GPIO_PIN);
		LED_G(ON);
		Delay(0xFFFFF);
	}
}
```

#### 总结：

固件库编程提高程序可移植性以及可读性，但是要做到对指定的IO口进行操作需要对固件库进行熟悉。（跟视频能打出来，但是自己上手还是有些勉强）